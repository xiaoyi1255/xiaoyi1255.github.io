import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.793cb3e4.js";const A=JSON.parse('{"title":"Vue3æºç ","titleTemplate":"Reactive","description":"","frontmatter":{"title":"Vue3æºç ","titleTemplate":"Reactive"},"headers":[],"relativePath":"guide/vue/reactive.md","lastUpdated":1722941564000}'),p={name:"guide/vue/reactive.md"},o=l(`<h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-label="Permalink to &quot;å‰è¨€ {#å‰è¨€}&quot;">â€‹</a></h2><p><strong>ä¸»é¢˜</strong>ï¼šæœ¬æ–‡å°†æ·±å…¥æ¢è®¨Vue3.2.47 æºç ä¸­ <strong>reactive</strong> çš„å®ç°</p><p><strong>èƒŒæ™¯</strong>ï¼šVue3å“åº”ç³»ç»Ÿåšäº†å…¨é¢å‡çº§ï¼Œä½¿å…¶æ€§èƒ½å’Œç¨³å®šæ€§å¾—åˆ°æå¤§æå‡ï¼ŒVue3ä¹Ÿå æ®å¤§é‡å‰ç«¯å¸‚åœº</p><p><strong>å†…å®¹</strong>ï¼šæœ¬æ–‡å°†åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œé¦–å…ˆä»‹ç»<strong>reactive</strong>åŠä½¿ç”¨ï¼Œç„¶å<strong>æºç è§£è¯»</strong>ï¼Œæœ€åæ€»ç»“<strong>reactive</strong> <strong>ä¼˜ç¼ºç‚¹</strong>åŠä½¿ç”¨<strong>æ³¨æ„äº‹é¡¹</strong></p><p><strong>ç›®çš„</strong>ï¼šæ‰‹æ¨¡æ‰‹æ·±å…¥å­¦ä¹ <strong>reactive</strong>åŸç†ğŸ˜</p><h2 id="reactiveæ˜¯ä»€ä¹ˆ?" tabindex="-1">reactiveæ˜¯ä»€ä¹ˆ? <a class="header-anchor" href="#reactiveæ˜¯ä»€ä¹ˆ?" aria-label="Permalink to &quot;reactiveæ˜¯ä»€ä¹ˆ? {#reactiveæ˜¯ä»€ä¹ˆ?}&quot;">â€‹</a></h2><p><strong>å®˜ç½‘</strong> <a href="https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive" target="_blank" rel="noreferrer">https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive</a></p><p><strong>reactive</strong> å‡½æ•°æ˜¯ Vue3 æºç ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒå‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡ã€‚æ‰€è°“å“åº”å¼å¯¹è±¡ï¼Œæ˜¯æŒ‡å½“è¯¥å¯¹è±¡çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚</p><p>åœ¨ Vue2 ä¸­ï¼Œå®ç°å“åº”å¼çš„æ–¹å¼æ˜¯é€šè¿‡ <strong>Object.defineProperty</strong> æ¥æ‹¦æˆªå±æ€§çš„è¯»å–å’Œè®¾ç½®æ“ä½œã€‚Vue3 ä¸­åˆ™é‡‡ç”¨äº†æ›´é«˜æ•ˆçš„ <strong>Proxy</strong> å¯¹è±¡æ¥å®ç°å“åº”å¼ï¼Œå› æ­¤ <strong>reactive</strong> å‡½æ•°åœ¨ Vue3 ä¸­æ‰®æ¼”äº†æ›´åŠ é‡è¦çš„è§’è‰²</p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨reactive?" tabindex="-1">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨reactive? <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨reactive?" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨reactive? {#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨reactive?}&quot;">â€‹</a></h2><p>åœ¨ä½¿ç”¨ Vue3 å¼€å‘åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç®€å•åœ°å®šä¹‰æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°è§†å›¾ã€‚å¦‚æœä¸ä½¿ç”¨ <strong>reactive</strong> å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œå¹¶æ‰‹åŠ¨è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚è¿™æ ·çš„ç¼–ç¨‹æ–¹å¼æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨reactive?" tabindex="-1">å¦‚ä½•ä½¿ç”¨reactive? <a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨reactive?" aria-label="Permalink to &quot;å¦‚ä½•ä½¿ç”¨reactive? {#å¦‚ä½•ä½¿ç”¨reactive?}&quot;">â€‹</a></h2><p>reactiveå‡½æ•°å‚æ•°</p><p>1ã€å“åº”å¼å¯¹è±¡ ã€åŒ…æ‹¬<strong>ref</strong>ã€<strong>reactive</strong> å£°æ˜çš„å“åº”å¼å¯¹è±¡ã€‘</p><p>2ã€çº¯å¯¹è±¡ [<strong>object</strong>, <strong>array</strong>, <strong>function</strong>, <strong>Set</strong>, <strong>Map</strong>]ç­‰</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1ã€åŸºæœ¬å¯¹è±¡  data æ­¤æ—¶å°±æ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å°æ˜“</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">paly</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ’­æ”¾</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">habbits</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åƒé¥­</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¡è§‰</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‰“è±†è±†</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2ã€ref , refä¼šè¢«è§£åŒ…ï¼Œ ä¿®æ”¹ count.value =&gt; numä¹Ÿè·Ÿç€ç”Ÿæ•ˆ</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#A6ACCD;">(count)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(count</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> num) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">++</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(num) </span><span style="color:#676E95;font-style:italic;">// 1</span></span>
<span class="line"></span></code></pre></div><p>ç›¸ä¿¡è¯»åˆ°è¿™é‡Œï¼Œå¯¹reactive æœ‰äº†åˆæ­¥äº†è§£ï¼Œæ¥ä¸‹æ¥ï¼Œ<strong>ä¸Šä¸»èœğŸ˜‚</strong></p><h2 id="æºç å…·ä½“å®ç°ï¼Ÿ" tabindex="-1">æºç å…·ä½“å®ç°ï¼Ÿ <a class="header-anchor" href="#æºç å…·ä½“å®ç°ï¼Ÿ" aria-label="Permalink to &quot;æºç å…·ä½“å®ç°ï¼Ÿ {#æºç å…·ä½“å®ç°ï¼Ÿ}&quot;">â€‹</a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/reactive.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä»£ç† çš„å¯¹è±¡å­˜åœ¨ WeakMap ä¸­</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> reactiveMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UnwrapNestedRefs</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// if trying to observe a readonly proxy, return the readonly version.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­ä¼ çš„å¯¹è±¡æ˜¯å¦æ˜¯ ä¸€ä¸ªåªè¯»å¯¹è±¡,æ˜¯è¿”å›åŸå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isReadonly</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createReactiveObject</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableHandlers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableCollectionHandlers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">reactiveMap</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createReactiveObject</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">isReadonly</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">baseHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">collectionHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">proxyMap</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WeakMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// val !== null &amp;&amp; typeof val === &#39;object&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__DEV__</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// dev ä¸‹ä¼ è¿‡æ¥çš„ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”æŠ›å‡ºè­¦å‘Šï¼Œ pro è¿”å›åŸå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">warn</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">value cannot be made reactive: </span><span style="color:#89DDFF;">\${</span><span style="color:#82AAFF;">String</span><span style="color:#A6ACCD;">(target)</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// target is already a Proxy, return it.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// exception: calling readonly() on a reactive object</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å·²ç»æ˜¯proxy ç›´æ¥è¿”å›</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ReactiveFlags.RAW è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«åŒ…è£…ä¸ºå“åº”å¼å¯¹è±¡</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ReactiveFlags.IS_REACTIVE æ ‡è®°è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">ReactiveFlags</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">RAW</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">/** __v_raw **/</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">isReadonly</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">ReactiveFlags</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IS_REACTIVE</span><span style="color:#F07178;">]) </span><span style="color:#676E95;font-style:italic;">/** __v_isReactive **/</span></span>
<span class="line"><span style="color:#F07178;">  ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// target already has corresponding Proxy</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦ å·²å­˜è¿›WeakMapä¸­ï¼Œå› ä¸ºæ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼ŒproxyMap.set(target, proxy)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">existingProxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxyMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">/** WeakMap **/</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">existingProxy</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">existingProxy</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// only specific value types can be observed.</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­æ˜¯å¦æ˜¯ ç™½åå•ä¸­çš„ç±»å‹</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// [&#39;Object&#39;,&#39;Array&#39;,&#39;Map&#39;,&#39;Set&#39;,&#39;WeakMap&#39;,&#39;WeakSet&#39;]</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å‰ä¸¤ä¸ª è¿”å›1 å4ä¸ª è¿”å›2 å…¶å®ƒçš„è¿”å›0</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getTargetType</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">targetType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INVALID</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">/** 0 **/</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä»¥ä¸Šæ¡ä»¶éƒ½æ»¡è¶³ åˆ™è¿›è¡Œä»£ç†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å‰ä¸¤ä¸ªtype ä½¿ç”¨ collectionHandlers åä¸¤ä¸ªä½¿ç”¨ baseHandlers</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// baseHandlersï¼š{get,set,deleteProperty,has,ownKeys} =&gt; [&#39;Object&#39;,&#39;Array&#39;]</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// collectionHandlers {get} =&gt; [&#39;Map&#39;,&#39;Set&#39;,&#39;WeakMap&#39;,&#39;WeakSet&#39;]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">targetType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">COLLECTION</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">collectionHandlers</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">baseHandlers</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">proxyMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">/** æ·»åŠ è¿› WeakMap å¯¹è±¡ [ç›®æ ‡å¯¹è±¡, ä»£ç†è¿‡åçš„å¯¹è±¡] **/</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä¸Šé¢ä»‹ç»äº†<strong>reactive</strong>å‡½æ•°ï¼Œè¿”å›äº†<strong>createReactiveObject</strong>å‡½æ•°ï¼Œå…¶å‚æ•°æœ‰å››ä¸ªï¼š</p><ol><li>target, åŸå¯¹è±¡</li><li>false, isReadonly</li><li>mutableHandlers, Objectå’ŒArrary çš„handlers</li><li>mutableCollectionHandlers, Set\\Map\\weakSet\\WeakMap çš„handlers</li><li>reactiveMapï¼Œå…¨å±€ä¿å­˜çš„WeakMapå¯¹è±¡</li></ol><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/reactive.ts#L32-L35</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> reactiveMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WeakMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// #L90-L102</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// if trying to observe a readonly proxy, return the readonly version.</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isReadonly</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createReactiveObject</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableHandlers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableCollectionHandlers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">reactiveMap</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="weakmap" tabindex="-1">WeakMap <a class="header-anchor" href="#weakmap" aria-label="Permalink to &quot;WeakMap&quot;">â€‹</a></h5><p>è®²åˆ°è¿™é‡Œï¼Œä½ ä»¬çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap" target="_blank" rel="noreferrer">WeakMap</a>æ¥è¿›è¡Œå­˜å‚¨ä¹ˆï¼Ÿ</p><ul><li>éœ€è¦å­˜å‚¨çš„keyæ˜¯ä¸€ä¸ªå¯¹è±¡</li><li>WeakMapæŒæœ‰çš„æ˜¯æ¯ä¸ªé”®å¯¹è±¡çš„â€œå¼±å¼•ç”¨â€</li><li>WeakMapä¸è¢«ä½¿ç”¨äº†ä¼šè‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶</li></ul><h5 id="mutablehandlers" tabindex="-1">mutableHandlers <a class="header-anchor" href="#mutablehandlers" aria-label="Permalink to &quot;mutableHandlers&quot;">â€‹</a></h5><p><strong>mutableHandlers</strong>: æ˜¯ Object å’Œ Array çš„ ä»£ç†å·¥å…·å¯¹è±¡</p><p><strong>ä»£ç†</strong>äº†ï¼šget\\set\\deleteProperty\\has\\ownKeys</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/baseHandlers.ts</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> get </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*#__PURE__*/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createGetter</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> set </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*#__PURE__*/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSetter</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mutableHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  get</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  set</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  deleteProperty</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  has</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ownKeys</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="mutablecollectionhandlers" tabindex="-1">mutableCollectionHandlers <a class="header-anchor" href="#mutablecollectionhandlers" aria-label="Permalink to &quot;mutableCollectionHandlers&quot;">â€‹</a></h5><p><strong>mutableCollectionHandlersï¼š</strong> æ˜¯&#39;Map&#39;,&#39;Set&#39;,&#39;WeakMap&#39;,&#39;WeakSet&#39;çš„ä»£ç†å·¥å…·å¯¹è±¡</p><p><strong>ä»£ç†äº†</strong>ï¼š get</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/collectionHandlers.ts#L366-L368</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mutableCollectionHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">CollectionTypes</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">Â  </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*#__PURE__*/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createInstrumentationGetter</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™é‡Œçœ‹äº†ä¸‹ï¼Œget\\set\\deleteProperty\\has\\ownKeys ç­‰<strong>æ‹¦æˆªå™¨å·¥å…·å‡½æ•°</strong>å†…å®¹æœ‰ç‚¹å¤šï¼Œå‡†å¤‡ä¸‹ä¸€æœŸå•ç‹¬åˆ†äº«</p><h3 id="è¾…åŠ©å‡½æ•°" tabindex="-1">è¾…åŠ©å‡½æ•° <a class="header-anchor" href="#è¾…åŠ©å‡½æ•°" aria-label="Permalink to &quot;è¾…åŠ©å‡½æ•° {#è¾…åŠ©å‡½æ•°}&quot;">â€‹</a></h3><h5 id="_1ã€isreadonlyå‡½æ•°" tabindex="-1">1ã€isReadonlyå‡½æ•° <a class="header-anchor" href="#_1ã€isreadonlyå‡½æ•°" aria-label="Permalink to &quot;1ã€isReadonlyå‡½æ•°&quot;">â€‹</a></h5><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/reactive.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isReadonly</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">// &#39;__v_isReadonly&#39;</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#F07178;">)[</span><span style="color:#A6ACCD;">ReactiveFlags</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IS_READONLY</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_2ã€gettargettype" tabindex="-1">2ã€getTargetType <a class="header-anchor" href="#_2ã€gettargettype" aria-label="Permalink to &quot;2ã€getTargetType&quot;">â€‹</a></h5><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/reactive.ts</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">enum</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TargetType</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">Â  INVALID </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">Â  COMMON </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">Â  COLLECTION </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">targetTypeMap</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">rawType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">rawType</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Object</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Array</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">COMMON</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Map</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">WeakMap</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">WeakSet</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">COLLECTION</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INVALID</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getTargetType</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// __v_skip || åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯æ‹“å±•</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">ReactiveFlags</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SKIP</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isExtensible</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TargetType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INVALID</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">/*0*/</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">targetTypeMap</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">toRawType</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">/*0 1 2*/</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_3ã€torawtype-ã€isobject" tabindex="-1">3ã€toRawType ã€isObject <a class="header-anchor" href="#_3ã€torawtype-ã€isobject" aria-label="Permalink to &quot;3ã€toRawType ã€isObject&quot;">â€‹</a></h5><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://github1s.com/vuejs/core/blob/v3.2.47/packages/shared/src/index.ts#L70-L77</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> objectToString </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toString</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> toTypeString </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">Â  objectToString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#A6ACCD;">(value)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> toRawType </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#676E95;font-style:italic;">// extract &quot;RawType&quot; from strings like &quot;[object RawType]&quot;</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">toTypeString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> isObject </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  val </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> val </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“ {#æ€»ç»“}&quot;">â€‹</a></h2><ol><li>å£°æ˜äº†ä¸€ä¸ªå…¨å±€çš„<strong>WeakMap</strong>å¯¹è±¡ç”¨æ¥å­˜ ä»£ç†å®Œçš„å¯¹è±¡ ****key <strong>: target,</strong> value <strong>: proxyObject</strong></li><li><strong>reactive</strong> å‡½æ•°çš„<a href="https://github1s.com/vuejs/core/blob/v3.2.47/packages/reactivity/src/reactive.ts#L90" target="_blank" rel="noreferrer">å£°æ˜</a> isReadonly ? return <strong>target</strong> : <strong>createReactiveObject</strong></li><li>è°ƒç”¨ createReactiveObject å‡½æ•°</li><li>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šç›´æ¥è¿”å› <strong>ç›®æ ‡å¯¹è±¡</strong><ol><li>åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡ ä¸æ˜¯ =&gt; <strong>dev</strong> æŠ›å‡ºè­¦å‘Š&amp;&amp; è¿”å›ç›®æ ‡å¯¹è±¡; <strong>pro</strong> è¿”å›ç›®æ ‡å¯¹è±¡</li><li>å¯¹è±¡å­˜åœ¨__v_raw å±æ€§ è¿”å›ç›®æ ‡å¯¹è±¡</li><li>åœ¨ å…¨å±€çš„weakMap å¯¹è±¡ä¸­ æ˜¯å¦æœ‰ç›®æ ‡å¯¹è±¡ï¼Œ<strong>æœ‰</strong>è¿”å›ç›®æ ‡å¯¹è±¡æ‰€ä»£ç†çš„ä»£ç†å¯¹è±¡</li><li>åˆ¤æ–­ç›®æ ‡å¯¹è±¡ç±»å‹åœ¨ä¸åœ¨ç™½åå•ç±»å‹åˆ—è¡¨ä¸­ï¼Œ<strong>ä¸åœ¨</strong> è¿”å›ç›®æ ‡å¯¹è±¡</li></ol></li></ol><p>ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶åˆ™é€šè¿‡ <strong>Proxy</strong>ä»£ç†å¯¹è±¡ å¹¶ å­˜è¿›<strong>weakMap</strong> ï¼Œç„¶åè¿”å›ä»£ç†åçš„å¯¹è±¡<br> object å’Œ array åˆ™æ‹¦æˆª <strong>get</strong> <strong>set</strong> <strong>deleteProperty</strong> <strong>has</strong> <strong>ownKeys</strong> è¿™é‡Œæ•°ç»„ä¹Ÿæœ‰å•ç‹¬åšå¤„ç† é›†åˆå¯¹è±¡ åˆ™æ‹¦æˆª <strong>get</strong> å¹¶åœ¨getæ“ä½œå»æ‹¦æˆª add set deleteç­‰æ–¹æ³•</p><h2 id="ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹" tabindex="-1">ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹ <a class="header-anchor" href="#ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹" aria-label="Permalink to &quot;ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹ {#ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹}&quot;">â€‹</a></h2><h4 id="reactiveä¼˜ç‚¹" tabindex="-1">reactiveä¼˜ç‚¹ï¼š <a class="header-anchor" href="#reactiveä¼˜ç‚¹" aria-label="Permalink to &quot;reactiveä¼˜ç‚¹ï¼š&quot;">â€‹</a></h4><ol><li>å®ç°æ•°æ®å“åº”å¼ï¼Œæ•°æ®çš„ä¿®æ”¹è‡ªåŠ¨æ›´æ–°è§†å›¾</li><li>å¯ä»¥ç›‘å¬åˆ°æ•°ç»„ã€å¯¹è±¡ã€é›†åˆå¯¹è±¡ç­‰å¤æ‚çš„æ•°æ®ç±»å‹çš„å˜åŒ–</li><li>æ–¹ä¾¿æ˜“ç”¨ï¼Œä¼ å…¥éœ€è¦å˜æˆå“åº”çš„æ•°æ®å³å¯</li></ol><h4 id="reactiveç¼ºç‚¹" tabindex="-1">reactiveç¼ºç‚¹ï¼š <a class="header-anchor" href="#reactiveç¼ºç‚¹" aria-label="Permalink to &quot;reactiveç¼ºç‚¹ï¼š&quot;">â€‹</a></h4><ul><li>ç¯å¢ƒçš„æ”¯æŒï¼Œä½¿ç”¨ES6çš„<strong>Proxy</strong> å®ç°ï¼Œéœ€è¦ç‰ˆæœ¬æ”¯æŒ</li><li><strong>reactive</strong> æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å¯¹å¯¹è±¡ç›‘å¬ï¼Œå› æ­¤å¯¹è±¡åµŒå¥—è¿‡æ·±ä¼šæœ‰ä¸€å®šæ€§èƒ½å¼€é”€</li></ul><h4 id="æ³¨æ„äº‹é¡¹" tabindex="-1">æ³¨æ„äº‹é¡¹ï¼š <a class="header-anchor" href="#æ³¨æ„äº‹é¡¹" aria-label="Permalink to &quot;æ³¨æ„äº‹é¡¹ï¼š&quot;">â€‹</a></h4><ul><li><strong>reactive</strong> å‡½æ•°ä¼šè¿”å›ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ isReactive åˆ¤æ–­æ˜¯å¦æ˜¯<strong>reactive</strong> åƒref å¯ä»¥ä½¿ç”¨ isRef</li><li>å¯¹reactiveå¯¹è±¡è¿›è¡Œ<strong>ç»“æ„</strong>ä½¿ç”¨çš„æ—¶å€™ï¼Œç»“æ„çš„æ˜¯å¯¹è±¡ä¸ä¼š<strong>å¤±æ´»ã€å¤±å»å“åº”å¼ã€‘</strong> ï¼ŒåŸºç¡€æ•°æ®ç±»å‹ä¼š<strong>å¤±æ´»</strong>, å¯ä»¥ä½¿ç”¨<strong>toRefs</strong> æ¥è¿›è¡Œç»“æ„</li></ul><hr><p><a href="https://juejin.cn/post/7205787772124495928" target="_blank" rel="noreferrer">æ‹¦æˆªå·¥å…·å‡½æ•°è§£è¯»</a></p>`,53),e=[o];function t(c,r,y,F,D,i){return a(),n("div",null,e)}const g=s(p,[["render",t]]);export{A as __pageData,g as default};
